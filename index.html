<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sapienza Open Notes ğŸ“˜âœ¨</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><text y='32' font-size='32'>ğŸ“˜âœ¨</text></svg>">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Sapienza Open Notes ğŸ“˜âœ¨</h1>
    <p>Appunti aperti e collaborativi della Sapienza UniversitÃ  di Roma</p>
  </header>

  <main>
    <section>
      <h2>ğŸ“– Il Progetto</h2>
      <p>
        <span class="highlight">Sapienza Open Notes</span> raccoglie, organizza e condivide appunti e materiali prodotti dagli studenti della Sapienza.  
        Lâ€™obiettivo Ã¨ creare un archivio <strong>libero, aperto e collaborativo</strong> per favorire lo studio e la cooperazione.
      </p>
    </section>

    <section>
      <h2>ğŸ¤ Collabora con noi</h2>
      <p>
        <span class="highlight">Sapienza Open Notes</span> Ã¨ aperto a tutti: aggiungi appunti, correggi errori o proponi miglioramenti.  
      </p>
      <div class="btn-container">
        <a href="https://github.com/filippodaminato/SapienzaOpenNotes" target="_blank" class="btn-primary">
          ğŸš€ Contribuisci su GitHub
        </a>
        <a href="./pages/tutorial.html" class="btn-secondary">
          ğŸ“˜ Leggi il tutorial
        </a>
      </div>
      <p class="text-center" style="font-style: italic; color: #555; margin-top: 1rem;">
        Ogni contributo rende questo archivio piÃ¹ utile per tutti ğŸ’¡
      </p>
    </section>

    <section>
      <h2>ğŸ“‚ Materiale disponibile</h2>
      <input type="text" id="searchBox" placeholder="Cerca per titolo, professore o anno..." class="search-box">

      <div class="filters">
        <select id="filterFaculty"><option value="">Tutte le facoltÃ </option></select>
        <select id="filterLevel"><option value="">Tutti i livelli</option></select>
        <select id="filterProfessor"><option value="">Tutti i professori</option></select>
      </div>

      <ul id="pdf-list">
        <li>Caricamento in corso...</li>
      </ul>
    </section>
  </main>

  <footer>
    <p>Â© 2025 Sapienza Open Notes â€“ Progetto open source degli studenti della Sapienza UniversitÃ  di Roma</p>
  </footer>

  <script>
    let pdfData = [];

    async function loadPDFs() {
      try {
        const response = await fetch('pdfs.json');
        pdfData = await response.json();
        populateFilters();
        renderList(pdfData);
      } catch (error) {
        console.error('Errore nel caricamento dei PDF:', error);
        document.getElementById('pdf-list').innerHTML = '<li>Errore nel caricamento dei file.</li>';
      }
    }

    function populateFilters() {
      const facultySet = new Set();
      const levelSet = new Set();
      const professorSet = new Set();

      pdfData.forEach(pdf => {
        if(pdf.faculty) facultySet.add(pdf.faculty);
        if(pdf.level) levelSet.add(pdf.level);
        if(pdf.professor) professorSet.add(pdf.professor);
      });

      const facultySelect = document.getElementById('filterFaculty');
      const levelSelect = document.getElementById('filterLevel');
      const professorSelect = document.getElementById('filterProfessor');

      facultySet.forEach(f => facultySelect.appendChild(new Option(f, f)));
      levelSet.forEach(l => levelSelect.appendChild(new Option(l, l)));
      professorSet.forEach(p => professorSelect.appendChild(new Option(p, p)));

      // Event listeners per filtri
      facultySelect.addEventListener('change', filterList);
      levelSelect.addEventListener('change', filterList);
      professorSelect.addEventListener('change', filterList);
      document.getElementById('searchBox').addEventListener('input', filterList);
    }

    function renderList(data) {
      const list = document.getElementById('pdf-list');
      list.innerHTML = '';

      if (data.length === 0) {
        list.innerHTML = '<li>Nessun file trovato.</li>';
        return;
      }

      data.forEach(pdf => {
        const li = document.createElement('li');
        li.innerHTML = `
          <a href="${pdf.file_name}" target="_blank">${pdf.title}</a>
          <span class="pdf-badge faculty">${pdf.faculty || ''}</span>
          <span class="pdf-badge level">${pdf.level || ''}</span>
          <span style="color:#aaa">â€“ ${pdf.professor} (${pdf.year})</span>
        `;
        list.appendChild(li);
      });
    }

    function filterList() {
      const query = document.getElementById('searchBox').value.toLowerCase();
      const facultyFilter = document.getElementById('filterFaculty').value;
      const levelFilter = document.getElementById('filterLevel').value;
      const professorFilter = document.getElementById('filterProfessor').value;

      const filtered = pdfData.filter(pdf => {
        return (
          (pdf.title.toLowerCase().includes(query) || pdf.professor.toLowerCase().includes(query) || pdf.year.toLowerCase().includes(query)) &&
          (facultyFilter === "" || pdf.faculty === facultyFilter) &&
          (levelFilter === "" || pdf.level === levelFilter) &&
          (professorFilter === "" || pdf.professor === professorFilter)
        );
      });
      renderList(filtered);
    }

    loadPDFs();
  </script>
</body>
</html>
